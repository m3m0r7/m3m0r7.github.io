<!DOCType html>
<html lang="">
<head>
  <meta charset="UTF-8" />
  <title>memory' portfolio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Noto+Sans+JP:wght@700&family=Roboto&family=Roboto+Mono" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <script src="https://kit.fontawesome.com/b88d781de7.js" crossorigin="anonymous"></script>
  <style>
    :root {
      --accent-color-1: #c6379c;
      --accent-color-2: #3c65aa;
    }
    html, body {
      padding: 0;
      margin: 0;
      font-family: "Noto Sans JP", sans-serif;
      overflow: hidden;
    }

    .contents {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 5;
    }

    section {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
    }

    .container {
      display: flex;
      flex-flow: column;
    }

    .container div {
      text-align: center;
    }

    .contacts {
      margin: 0;
      padding: 0;
      display: grid;
      grid-gap: 20px;
      grid-template-columns: repeat(4, calc(((400px - 20px) / 4)));
      list-style: none;
      height: 54px;
      text-align: center;
      font-size: 54px;
      line-height: 54px;
    }

    .contacts a {
      color: transparent;

      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      background-clip: text;


      animation: animate-background;
      animation-duration: 20s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    .contacts a {
      transition: opacity ease 0.4s;
    }

    .contacts a:hover {
      opacity: 0.4;
    }

    .e-mail, .name {
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      background-clip: text;
      color: transparent;
      font-size: 24px;
      margin: 0;
      padding: 0;
      margin-bottom: 40px;

      animation: animate-background;
      animation-duration: 20s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    .name {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .e-mail::after {
      content: "@gmail.com"
    }

    .balloon-container {
      position: fixed;
      z-index: 1;
    }

    .balloon-container img {
      display: block;
    }

    @keyframes animate-background {
      0% {
        background-position: 0 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0 50%;
      }
    }

    .is-mobile {
      display: none;
    }

    .\!is-mobile {
      display: inline;
    }

    .balloon-container-opener {
      position: absolute;
      top: 0;
      right: 0;
      width: 350px;
      height: 175px;
      overflow: hidden;
      cursor: pointer;
      z-index: 10;
    }

    .balloon-container-opener .balloon-container {
      top: -20px;
      right: -20px;
      transition: top ease 0.5s, right ease 0.5s ;
    }

    .balloon-container-opener:hover .balloon-container {
      top: 0;
      right: 0;
    }

    #opener + .info-contents {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255, 255, 255, 0.65);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      opacity: 0;
      transition: opacity ease 0.3s, z-index ease 0.3s;
      z-index: -1;
    }

    #opener {
      display: none;
    }

    #opener:checked + .info-contents {
      opacity: 1;
      z-index: 30;
    }

    .info-contents {
      padding: 40px;
      box-sizing: border-box;
    }

    .info-contents-container-scrollable {
      height: calc(100% - 40px - 40px);
      box-sizing: border-box;
      overflow: scroll;
      margin-top: 40px;
    }

    .info-contents-container {
      display: flex;
    }

    .close-button {
      display: inline-block;
    }

    .close-button i {
      font-size: 32px;
      cursor: pointer;
      color: #888888;
    }

    h2 {
      font-size: 32px;
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      background-clip: text;
      color: transparent;
      animation: animate-background;
      animation-duration: 20s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
      margin: 0;
      padding: 0;
    }

    .info-contents-list {
      width: 100%;
    }

    .info-contents-list-bar {
      margin-left: 152px;
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      width: 1px;

    }

    .info-contents-list dt {
      position: relative;
    }

    .info-contents-list dt .title {
      font-size: 24px;
      display: inline-block;
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      font-weight: 700;
      background-clip: text;
      color: transparent;
      animation: animate-background;
      animation-duration: 20s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
      position: relative;
      padding-left: 12px;
    }

    .info-contents-list dt .title a {
      text-decoration: none;
      color: transparent;
    }

    .info-contents-list dt .icon {
      position: absolute;
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      border-radius: 50%;
      width: 25px;
      height: 25px;
      left: -13px;
      top: calc(7px);
    }

    .info-contents-list dt .outer-content {
      position: absolute;
      left: -154px;
      top: 1px;
      width: 134px;
      text-align: right;

    }
    .info-contents-list dt .outer-content time {
      font-size: 24px;
      text-align: right;
      background: linear-gradient(140deg, var(--accent-color-1) 0%, var(--accent-color-2) 100%);
      background-clip: text;
      font-weight: 700;
      color: transparent;
    }

    .info-contents-list dt {
      padding: 0 0 0 10px;
    }

    .info-contents-list dd {
      padding: 10px 10px 20px 20px;
      margin: 0;
    }

    .info-contents-list dd a {
      text-decoration: none;
      color: inherit;
    }

    .info-contents-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
    }

    .info-contents-list dd .info-contents-list-subtitle,
    .info-contents-list dd time {
      font-size: 14px;
    }

    .info-contents-list dd .info-contents-list-subtitle {
      margin-top: 2px;
    }


    .info-contents-list-item .type\[figure\] .info-contents-list-subtitle {
      font-size: 16px;
    }

    .info-contents-list-description {
      font-size: 14px;
      color: #666666;
    }

    .info-contents-list ul li {
      font-size: 12px;
    }

    .info-contents-list-tags {
      margin-top: 8px;
    }


    .info-contents-list-tags ul {
      display: flex;
    }

    .info-contents-list dd time {
      color: #666666;
    }

    .info-contents-list-tags li {
      border: 1px solid #666666;
      color: #666666;
      padding: 2px 6px;
      border-radius: 4px;
      margin-right: 4px;
    }

    .info-contents-list-item {
      margin-bottom: 20px;
      position: relative;
    }

    .info-contents-list-item.info-contents-list-item\[experience\.position\] time {
      display: block;
      width: 170px;
      text-align: right;
      left: -205px;
    }

    .info-contents-list-item a {
      text-decoration: none;
    }

    .info-contents-list-item time {
      position: absolute;
      text-align: right;
      left: -90px;
      top: 1px;
    }

    .info-contents-list-item .icon {
      position: absolute;
      background: #666666;
      border-radius: 50%;
      width: 13px;
      height: 13px;
      left: -27px;
      top: calc(6px);
    }

    .info-contents-list-item .type\[figure\],
    .info-contents-list-item .type\[activity\] {
      background: rgba(0, 0, 0, 0.08);
      border-radius: 4px;
      padding: 12px 8px;
      width: 100%;
      box-sizing: border-box;

      transition: background-color ease 0.3s;
    }

    .info-contents-list-item .type\[activity\] {
      padding-left: 12px;
    }

    .info-contents-list-item .type\[activity\] .info-contents-list-subtitle {
      margin-top: 0;
    }

    .info-contents-list-item .type\[figure\] {
      display: grid;
      grid-template-columns: 100px 1fr;
      height: 140px;
      gap: 4px;
      grid-template-areas: "col1 col2";
    }

    .info-contents-list-item .type\[figure\]:hover,
    .info-contents-list-item .type\[activity\]:hover {
      background: rgba(0, 0, 0, 0.03);
    }

    .info-contents-list-item .type\[figure\],
    .info-contents-list-item .type\[activity\] {
      color: #333333;
    }


    .info-contents-list-item .type\[figure\] time {
      color: #777777;
    }

    .info-contents-list-figure {
      background-size: contain;
      background-repeat: no-repeat;
      background-position: 50% 50%;
    }

    .info-contents-list-item\[activity\.unpublished\] .info-contents-list-subtitle,
    .info-contents-list-item\[article\.unpublished\] .info-contents-list-subtitle {
      text-decoration: line-through;
    }

    @media (max-width: 500px) {

      .is-mobile {
        display: inline;
      }

      .\!is-mobile {
        display: none;
      }

      .intro {
        padding: 0 20px;
      }
      .contacts {
        grid-template-columns: repeat(4, calc(((100vw - 80px - 40px - 20px) / 4)));
        font-size: 36px;
        height: 36px;
        line-height: 36px;
      }

      .contacts-container, .email-container {
        background: #FFFFFF;
        border-radius: 50px;
        padding: 10px;
      }

      .container {
        position: relative;
        top: 40px;
      }

      .e-mail, .name {
        margin-bottom: 10px;
      }

      .e-mail {
        margin-bottom: 0;
        font-size: 18px;
        font-weight: 0;
      }

      .email-container {
        margin-bottom: 10px;
      }

      .info-contents-list dt,
      .info-contents-list dt .title {
        padding: 0;
      }
      .info-contents-list dt .icon {
        display: none;
      }

      .info-contents-list dt .outer-content {
        position: initial;
        left: initial;
        top: initial;
        width: initial;
        text-align: initial;
      }

      .info-contents-list-item .icon {
        display: none;
      }

      .info-contents-list-item time {
        position: initial;
        left: initial;
        top: initial;
      }

      .info-contents-list-item.info-contents-list-item\[experience\.position\] time {
        width: initial;
        text-align: initial;
      }

      .info-contents-list dd {
        padding: 10px 0 20px 0;
      }

      .info-contents-list-bar {
        display: none;
      }

      .info-contents {
        padding: 20px;
      }
    }

  </style>
  <script>
    const CODE_NAME = 'WISTERIA';

    window.WISTERIA = {
      cache: {
        keyPrefix: 'cache:fetch:v2:',
        fetch: {
          lifetime: 60 * 5,
        },
      },
      lang: (new URLSearchParams(location.search)).get('lang') === 'en' ? 'en' : 'ja',
      gtag: 'G-9ML40PK6KJ',
      data: {
        api: {
          my: './my.json',
          articles: './articles.json',
          activities: './activities.json',
        },
      },
      i18n: {
        characters: {
          ja: "{0} 文字",
          en: "{0} character(s)",
        },
        joinTo: {
          ja: "{0} にジョイン",
          en: "Join to {0}",
        },
        now: {
          ja: "現在",
          en: "Now",
        },
        postedNewArticle: {
          ja: "新しい投稿",
          en: "Posted a new book",
        },
        publishedNewBook: {
          ja: "新しい著書",
          en: "Published a new book",
        },
        talked: {
          ja: "登壇",
          en: "Talked",
        },
        unPublished: {
          ja: "(非公開) ",
          en: "(Unpublished) ",
        },
        createdNewOSS: {
          ja: "新しい OSS の公開",
          en: "Created a new OSS"
        }
      }
    }
  </script>
</head>
<body>
<label for="opener" class="balloon-container-opener" >
  <div class="balloon-container">
    <img src="./assets/balloon-svg-1.svg" alt=""/>
  </div>
</label>
<div class="balloon-container" style="bottom: 0; left: 0;"><img src="./assets/balloon-svg-2.svg" alt=""/></div>

<input id="opener" type="checkbox" tabindex="-1" />
<div class="info-contents">
  <div>
    <label for="opener" class="close-button"><i class="fa-solid fa-xmark"></i></label>
  </div>
  <div class="info-contents-container-scrollable">
    <div class="info-contents-container">
      <div class="info-contents-list-bar"></div>
      <dl class="info-contents-list"></dl>
    </div>
  </div>
</div>

<div class="contents">
  <section>
    <div class="container">
      <div>
        <svg class="is-mobile" width="320" height="320" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="svg-gradient" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2="100%" y2="0">
              <stop offset="5%" stop-color="#c6379c" />
              <stop offset="100%" stop-color="#3c65aa" />
            </linearGradient>
            <path id="circlePath" d="M 160,160 m -120,0 a 120,120 0 1,1 240,0 a 120,120 0 1,1 -240,0" />
            <clipPath id="clipPath">
              <circle cx="160" cy="160" r="106" fill="url(#svg-gradient)" />
            </clipPath>
          </defs>
          <circle cx="160" cy="160" r="120" fill="none" />
          <g>
            <circle cx="160" cy="160" r="116" fill="url(#svg-gradient)" />
            <animateTransform attributeName="transform"
                              type="rotate"
                              from="0 160 160"
                              to="360 160 160"
                              dur="10s"
                              repeatCount="indefinite" />
          </g>
          <circle cx="160" cy="160" r="111" fill="white" />
          <g>
            <image
              href="./assets/logical_stylish_memory.png"
              x="50"
              y="50"
              width="221"
              height="221"
              clip-path="url(#clipPath)" />
          </g>
          <g>
            <text fill="url(#svg-gradient)" font-size="26" font-family="Roboto Mono, Noto Sans JP">
              <textPath class="hello-world-text" xlink:href="#circlePath" startOffset="0%" text-anchor="start">
              </textPath>
              <animateTransform attributeName="transform"
                                type="rotate"
                                from="0 160 160"
                                to="360 160 160"
                                dur="20s"
                                repeatCount="indefinite" />
            </text>
          </g>
        </svg>

        <svg class="!is-mobile" width="400" height="400" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="normally-svg-gradient" gradientUnits="userSpaceOnUse" x1="0" y1="0" x2="100%" y2="0">
              <stop offset="5%" stop-color="#c6379c" />
              <stop offset="100%" stop-color="#3c65aa" />
            </linearGradient>
            <path id="normally-circlePath" d="M 200,200 m -150,0 a 150,150 0 1,1 300,0 a 150,150 0 1,1 -300,0" />
            <clipPath id="normally-clipPath">
              <circle cx="200" cy="200" r="132" fill="url(#normally-svg-gradient)" />
            </clipPath>
          </defs>
          <circle cx="200" cy="200" r="150" fill="none" />
          <g>
            <circle cx="200" cy="200" r="145" fill="url(#normally-svg-gradient)" />
            <animateTransform attributeName="transform"
                              type="rotate"
                              from="0 200 200"
                              to="360 200 200"
                              dur="10s"
                              repeatCount="indefinite" />
          </g>
          <circle cx="200" cy="200" r="138" fill="white" />
          <g>
            <image
              href="./assets/logical_stylish_memory.png"
              x="62"
              y="62"
              width="276"
              height="276"
              clip-path="url(#normally-clipPath)"
            />
          </g>

          <g>
            <text fill="url(#normally-svg-gradient)" font-size="32" font-family="Roboto Mono, Noto Sans JP">
              <textPath class="hello-world-text" xlink:href="#normally-circlePath" startOffset="0%" text-anchor="start">
              </textPath>
              <animateTransform attributeName="transform"
                                type="rotate"
                                from="0 200 200"
                                to="360 200 200"
                                dur="20s"
                                repeatCount="indefinite" />
            </text>
          </g>
        </svg>
      </div>
      <div class="intro">
        <div>
          <p class="name"><span>めもりー</span></p>
        </div>
        <div class="email-container">
          <p class="e-mail"><span>memory.style.serv</span></p>
        </div>
        <div class="contacts-container">
          <ul class="contacts">
            <li><a target="_blank" class="no-arrow" href="https://x.com/m3m0r7"><i class="fa-brands fa-x-twitter"></i></a></li>
            <li><a target="_blank" class="no-arrow" href="https://github.com/m3m0r7"><i class="fa-brands fa-github"></i></a></li>
            <li><a target="_blank" class="no-arrow" href="https://speakerdeck.com/memory1994"><i class="fa-brands fa-speaker-deck"></i></a></li>
            <li><a target="_blank" class="no-arrow" href="https://www.linkedin.com/in/m3m0r7"><i class="fa-brands fa-linkedin-in"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  String.prototype.toHex = function () {
    return Array.from((new TextEncoder()).encode(this))
      .map(num => num.toString(16).toUpperCase().padStart(2, '0'))
  }
  document.addEventListener('DOMContentLoaded', () => {
    const replaceGreetingMessage = () => {
      const greetingType = [
        'en',
        'ja',
        'ge',
        'fr',
        'it',
      ];
      const greetingTexts = {
        en: 'Hello World!',
        ja: 'こんにちは、世界！',
        ge: 'Hallo Welt!',
        fr: 'Bonjour le monde!',
        it: 'Ciao mondo!',
      };

      const greetingTarget = greetingType[Math.floor(Math.random() * greetingType.length)];
      const greetingText = greetingTexts[greetingTarget];
      const greetingMessages = [
        '&lt;?php echo "' + greetingText + '"; ?&gt;',
        'puts "' + greetingText + '"',
        'console.log("' + greetingText + '")',
        'System.out.print("' + greetingText + '")',
        'fmt.Print("' + greetingText + '")',
        'std::cout << "' + greetingText + '"',
        'print!("' + greetingText + '")',
      ];

      if (greetingTarget === 'en' || greetingTarget === 'ge' || greetingTarget === 'fr') {
        greetingMessages.push(
          'mov esi, text_' + greetingText.replace(/[\!\s]/g, '').toHex().join(''),
          greetingText.toHex().join(' '),
        )
      }

      document.querySelectorAll('.hello-world-text')
        .forEach(elem => elem.innerHTML = greetingMessages[Math.floor(Math.random() * greetingMessages.length)])
    }

    replaceGreetingMessage();

    const konamiCommand = [
      'ArrowUp',
      'ArrowUp',
      'ArrowDown',
      'ArrowDown',
      'ArrowLeft',
      'ArrowRight',
      'ArrowLeft',
      'ArrowRight',
      'b',
      'a',
    ];

    let capturedCommands = [];
    document.addEventListener('keyup', function (e) {
      capturedCommands.push(e.key);
      if (capturedCommands.join(' ') !== konamiCommand.slice(0, capturedCommands.length).join(' ')) {
        capturedCommands = [];
      } else if (capturedCommands.length === konamiCommand.length) {
        // NOTE: Re-new greeting message when entered the konami command.
        replaceGreetingMessage();

        // NOTE: Reset captured commands
        capturedCommands = [];
      }
    })
  })
</script>
<script>
  const open = (target) => {
    document.querySelector(target).classList.remove('off')
    document.querySelector(target).classList.add('on')
  }
  const close = (target) => {
    document.querySelector(target).classList.remove('on')
  }

  document.addEventListener('DOMContentLoaded', e => {
    document.querySelectorAll('[data-open-target]').forEach(elem => {
      elem.addEventListener('click', e => {
        e.stopImmediatePropagation();
        open(e.currentTarget.getAttribute('data-open-target'))
      })
    })

    document.querySelectorAll('[data-close-target]').forEach(elem => {
      elem.addEventListener('click', e => {
        close(e.currentTarget.getAttribute('data-close-target'))
      })
    })
  })
</script>
<script>
  Object.defineProperty(Date.prototype, 'withDay', {
    value: true,
    writable: true,
  })

  Date.prototype.format = function (format) {
    return format.replace(
      'YYYY',
      this.getFullYear(),
    ).replace(
      'M',
      this.getMonth() + 1,
    ).replace(
      'D',
      this.getDate(),
    )
  }
  Node.prototype.loadData = function (path) {
    const key = window.WISTERIA.cache.keyPrefix + path;
    const item = localStorage.getItem(key);
    const data = JSON.parse(item ? item : "{}");
    const fireEvent = (eventName, payload) => {
      this.dispatchEvent(new CustomEvent(eventName, {
        bubbles: true,
        detail: {
          name: path,
          value: payload,
        },
      }));
    };

    const body = {
      path: path,
    };

    fireEvent('LoadData', body);
    fireEvent('LoadData:' + path, body);

    if (item && (new Date()).getTime() <= data.ttl) {
      return new Promise(resolve => {
        const body = {
          path: path,
          payload: data.body,
        };

        fireEvent('LoadedData', body);
        fireEvent('LoadedData:' + path, body);
        resolve(data.body);
      });
    }

    return fetch(path, {
      mode: 'cors',
      cache: 'default',
      headers: {},
    }).then(response => response.json())
      .then(json => {
        localStorage.setItem(
          key,
          JSON.stringify({
            ttl: (new Date()).getTime() + (window[CODE_NAME].cache.fetch.lifetime * 1000),
            body: json,
          })
        );

        const body = {
          path: path,
          payload: json
        };

        fireEvent('LoadedData', body);
        fireEvent('LoadedData:' + path, body);

        return new Promise(resolve => resolve(json));
      })
  }

  const i18n = (name, ...args) => {
    if (!window[CODE_NAME].i18n[name]) {
      throw Error('Not found ' + name);
    }
    return window[CODE_NAME].i18n[name][window[CODE_NAME].lang].replace(
      /\{\s*(\d+)\s*\}/g,
      (_, num) => args[parseInt(num)],
    );
  }

  const renderActivity = (activity, layout = 'info-contents-item') => {
    const template = (name, props = {}) => {
      const target = Array.from(document.querySelectorAll('script[data-template-name]'))
        .find(elem => elem.getAttribute('data-template-name').replace(/\s{2,}/g, ' ').split(' ').includes(name));

      if (!target) {
        return undefined;
      }

      return target
        .innerText
        .replace(/{([^}]+)}/g, (args, name) => {
          name = name.replace(/^\s+/, '').replace(/\s+$/, '');
          return props[name] || '';
        });
    }

    const formatDate = (time) => {
      if (!time) {
        return '';
      }
      if (typeof time === 'string') {
        return time;
      }
      if (time instanceof Date) {
        return time.format(
          time.withDay
            ? 'YYYY/M/D'
            : 'YYYY/M'
        );
      }

      return time.start.format(
        time.start.withDay
          ? 'YYYY/M/D'
          : 'YYYY/M'
      ) + ' - ' + (time.end ? time.end.format(
        time.end.withDay
          ? 'YYYY/M/D'
          : 'YYYY/M'
      ) : i18n('now'))
    }

    const tags = template('info-contents-tags', {
      children: activity.tags
        .map(tag => template('info-contents-tag', {
          children: tag,
        })).join('')
    });

    const date = formatDate(activity.time);

    const unpublished = activity.tags.includes('Unpublished')
      ? '[unpublished]'
      : '';

    return template(layout, {
      type: activity.type,
      date: activity.time ? template('info-contents-item-date', {
        children: typeof activity.time === 'string'
          ? activity.time
          : (
            activity.time instanceof Date
              ? activity.time.format(activity.time.withDay ? 'YYYY/M/D' : 'YYYY/M')
              : activity.time.start.format(activity.time.start.withDay ? 'YYYY/M/D' : 'YYYY/M')
          )
      }) : '',
      title: activity.link
        ? template('info-contents-item-title' + unpublished, {
          link: activity.link,
          children: activity.title
        })
        : activity.title,
      children: template('info-contents-body[' + activity.type + ']', {
        type: activity.type,
        image: activity.image,
        date: date,
        link: activity.link,
        subtitle: activity.subtitle,
        description: activity.description,
        tags: tags,
        children: typeof activity.children === 'string'
          ? activity.children
          : (
            activity.children
              ? activity.children.map(item => renderActivity(item)).join('')
              : ''
          )
      }),
    });
  };

  document.addEventListener('DOMContentLoaded', function (e) {
    const promises = [];

    promises.push(
      e.target.loadData(window[CODE_NAME].data.api.my).then((payload) => {
        const activities = [];

        activities.push({
          type: "summary",
          title: "Summary",
          children: payload.summary[window[CODE_NAME].lang]
            .reduce((acc, value) => acc + (value || '') + "<br />", ""),
          tags: [],
        });

        payload.books.forEach(book => {
          book.authors.forEach(author => {
            activities.push({
              type: "book",
              time: new Date(author.published_at),
              image: author.image,
              link: author.link,
              title: i18n("publishedNewBook"),
              subtitle: author.title[window[CODE_NAME].lang],
              description: book.publisher[window[CODE_NAME].lang],
              tags: ["Book", ...author.tags],
            });
          })
        });

        payload.experiences.forEach(experience => {
          const items = experience.positions.map(position => ({
            type: "experience.position",
            subtitle: position.name[window[CODE_NAME].lang],
            time: {
              start: new Date(position.start),
              end: position.end === null
                ? position.end
                : new Date(position.end),
            },
            tags: [],
          })).sort(
            (a, b) => a.time.end === null || b.time.end === null
              ? 1
              : a.time.end.getTime() - a.time.start.getTime(),
          );

          items.forEach(item => {
            if (item.time.start instanceof Date) {
              item.time.start.withDay = false;
            }
            if (item.time.end instanceof Date) {
              item.time.end.withDay = false;
            }
          })

          activities.push({
            type: "experience",
            time: items[0].time.start,
            title: i18n('joinTo', experience.name[window[CODE_NAME].lang]),
            children: items,
            tags: [],
          });
        });

        return activities;
      })
    );

    promises.push(
      e.target.loadData(window[CODE_NAME].data.api.articles).then((payload) => {
        const activities = [];

        payload.posts.forEach(post => {
          activities.push({
            type: "article",
            time: new Date(post.createdAt),
            link: "https://sizu.me/memory/posts/" + post.slug,
            title: i18n("postedNewArticle"),
            subtitle: post.title,
            description: i18n('characters', post.bodyCharacterCount.toLocaleString('en-US')),
            tags: ["Article", ...post.tags],
          });
        })

        return activities;
      })
    );

    promises.push(
      e.target.loadData(window[CODE_NAME].data.api.activities).then((payload) => {
        const activities = [];

        payload.forEach(activity => {
          const isOSS = activity.tags.includes('OSS');
          const isTalk = activity.tags.includes('Talk');
          const unpublished = activity.tags.includes('Unpublished')
            ? '.unpublished'
            : '';

          if (isOSS) {
            activities.push({
              type: "activity" + unpublished,
              time: new Date(activity.published_at),
              link: activity.url,
              title: i18n("createdNewOSS"),
              subtitle: activity.title,
              description: activity.description,
              tags: activity.tags,
            });
            return;
          }
          activities.push({
            type: "activity" + unpublished,
            time: new Date(activity.published_at),
            link: activity.url,
            title: i18n("talked"),
            subtitle: (activity.tags.includes('Unpublished') ? i18n("unPublished") : '') + activity.title,
            description: activity.location,
            tags: activity.tags,
          });
        })

        return activities;
      })
    );

    Promise.all(promises).then((results) => {
      const sortedActivities = results.reduce((acc, activities) => [...acc, ...activities], []).sort(
        (a, b) => {
          if (a.type === 'summary' || b.type === 'summary') {
            return 1;
          }
          return !a.time || !b.time
            ? 1
            : b.time.getTime() - a.time.getTime()
        }
      );

      document.querySelector('.info-contents-list').innerHTML = sortedActivities
        .map(activity => renderActivity(activity, 'info-contents-item-layout')).join('');
    });
  })
</script>
<script type="text/plain" data-template-name="info-contents-tags">
  <ul>{children}</ul>
</script>
<script type="text/plain" data-template-name="info-contents-tag">
  <li>{children}</li>
</script>
<script type="text/plain" data-template-name="info-contents-body[book]">
  <div class="info-contents-list-item">
    <a href="{link}" target="_blank">
      <div class="type[figure]">
        <div class="info-contents-list-figure" style="background-image: url(./assets/books/{image});"></div>
        <div class="info-contents-list-figure-summary">
          <div class="info-contents-list-subtitle">
            {subtitle}
          </div>
          <div class="info-contents-list-description">
            {description}
          </div>
        </div>
      </div>
    </a>
    <div class="info-contents-list-tags">
      {tags}
    </div>
  </div>
</script>
<script type="text/plain" data-template-name="info-contents-body[activity] info-contents-body[article]">
  <div class="info-contents-list-item">
    <a href="{link}" target="_blank">
      <div class="type[activity]">
        <div class="info-contents-list-subtitle">
          {subtitle}
        </div>
        <div class="info-contents-list-description">
          {description}
        </div>
      </div>
    </a>
    <div class="info-contents-list-tags">
      {tags}
    </div>
  </div>
</script>

<script type="text/plain" data-template-name="info-contents-body[activity.unpublished] info-contents-body[article.unpublished]">
  <div class="info-contents-list-item">
    <div class="info-contents-list-item[{type}]">
      <div class="info-contents-list-subtitle">
        {subtitle}
      </div>
      <div class="info-contents-list-description">
        {description}
      </div>
    </div>
    <div class="info-contents-list-tags">
      {tags}
    </div>
  </div>
</script>
<script type="text/plain" data-template-name="info-contents-body[summary]">
  <div class="info-contents-list-item">
    <div>
      {children}
    </div>
  </div>
</script>
<script type="text/plain" data-template-name="info-contents-body[experience]">
  {children}
</script>
<script type="text/plain" data-template-name="info-contents-body[experience.position]">
  <div class="info-contents-list-item info-contents-list-item[experience.position]">
    <div class="icon"></div>
    <time>{date}</time>
    <div>
      <div class="info-contents-list-subtitle">
        {subtitle}
      </div>
    </div>
    <div class="info-contents-list-tags">
      {tags}
    </div>
  </div>
</script>
<script type="text/plain" data-template-name="info-contents-item-title">
  <a href="{link}" target="_blank">{children}</a>
</script>
<script type="text/plain" data-template-name="info-contents-item-title[unpublished]">
  {children}
</script>
<script type="text/plain" data-template-name="info-contents-item-date">
  <div class="outer-content"><time>{children}</time></div>
</script>
<script type="text/plain" data-template-name="info-contents-item-layout">
  <dt>
    <div class="icon"></div>
    {date}
    <div class="title">{title}</div>
  </dt>
  <dd>{children}</dd>
</script>
<script type="text/plain" data-template-name="info-contents-item">
  {children}
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  document.addEventListener('DOMContentLoaded', () => {
    const script = document.createElement('script');
    script.setAttribute('src', 'https://www.googletagmanager.com/gtag/js?id=' + window[CODE_NAME].gtag);

    document.querySelector('body').appendChild(script);

    script.addEventListener('load', () => {
      gtag('js', new Date());

      gtag('config', window[CODE_NAME].gtag);
    })
  })

  function gtag(){dataLayer.push(arguments);}
</script>
</body>
</html>
